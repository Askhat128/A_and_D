<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>RSVP форма</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('фон.jpg') center/cover no-repeat;
      padding: 20px;
      color: #333;
    }
    form {
      background: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border-radius: 8px;
    }
    .hidden { display: none; }
    .guest-block {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f9f9f9;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input[type=text], select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    #status {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <form id="rsvpForm">
    <h2>1. Подтвердите ваше участие:</h2>
    <label><input type="radio" name="attendance" value="yes" required> Придем</label>
    <label><input type="radio" name="attendance" value="no"> Не сможем присутствовать</label>

    <div id="noSection" class="hidden">
      <label>ФИО:<input type="text" name="noFio" id="noFio" ></label>
      <p>Нам очень жаль, но спасибо за поздравление!</p>
    </div>

    <div id="yesSection" class="hidden">
      <label>2. Укажите количество гостей от семьи:
        <select id="guestCount" name="guestCount" required>
          <option value="">-- выберите --</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </label>
      <div id="guestsContainer"></div>
    </div>

    <label>4. Откуда вы к нам приедете?
      <input type="text" id="origin" name="origin" required />
    </label>

    <button type="submit" id="submitBtn" disabled>Отправить</button>
    <div id="status"></div>
  </form>

  <script>
    const rsvpForm = document.getElementById('rsvpForm');
    const noSection = document.getElementById('noSection');
    const yesSection = document.getElementById('yesSection');
    const guestCountSelect = document.getElementById('guestCount');
    const guestsContainer = document.getElementById('guestsContainer');
    const submitBtn = document.getElementById('submitBtn');
    const statusDiv = document.getElementById('status');

    const scriptURL = 'https://script.google.com/macros/s/AKfycbzubPmFw_MwtfOByDKnlLX1ZVUgOIf9lI4-X4EqnOHV32Nnha3rPKyWfWaSTkGrVBea/exec'; // Вставь сюда URL своего Google Apps Script

    // Алкогольные варианты
    const alcoholOptions = `
      <option value="">-- Выберите --</option>
      <option value="Красное вино">Красное вино</option>
      <option value="Белое вино">Белое вино</option>
      <option value="Самогон">Самогон</option>
      <option value="Не пью алкоголь">Не пью алкоголь</option>
    `;

    // Отслеживаем выбор участия
    rsvpForm.attendance.forEach(radio => {
      radio.addEventListener('change', () => {
        const val = rsvpForm.attendance.value;
        if (val === 'no') {
          noSection.classList.remove('hidden');
          yesSection.classList.add('hidden');
          guestCountSelect.value = '';
          guestsContainer.innerHTML = '';
          submitBtn.disabled = false;
        } else if (val === 'yes') {
          yesSection.classList.remove('hidden');
          noSection.classList.add('hidden');
          submitBtn.disabled = true;
        } else {
          yesSection.classList.add('hidden');
          noSection.classList.add('hidden');
          submitBtn.disabled = true;
        }
        statusDiv.textContent = '';
      });
    });

    // При выборе количества гостей создаём блоки
    guestCountSelect.addEventListener('change', () => {
      guestsContainer.innerHTML = '';
      const count = parseInt(guestCountSelect.value);
      if (!count) {
        submitBtn.disabled = true;
        return;
      }
      for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.classList.add('guest-block');
        div.innerHTML = `
          <label>ФИО гостя ${i}:<input type="text" name="guestFio${i}" required /></label>
          <label>Какой алкоголь предпочитаете?
            <select name="guestAlcohol${i}" required>${alcoholOptions}</select>
          </label>
          <label>Есть ли аллергия?
            <input type="text" name="guestAllergy${i}" />
          </label>
        `;
        guestsContainer.appendChild(div);
      }
      validateForm();
    });

    // Валидация формы и включение кнопки отправки
    rsvpForm.addEventListener('input', validateForm);

    function validateForm() {
      const attendance = rsvpForm.attendance.value;
      if (attendance === 'no') {
        submitBtn.disabled = !(rsvpForm.noFio.value.trim());
      } else if (attendance === 'yes') {
        if (!guestCountSelect.value || !rsvpForm.origin.value.trim()) {
          submitBtn.disabled = true;
          return;
        }
        for (let i = 1; i <= parseInt(guestCountSelect.value); i++) {
          if (
            !rsvpForm[`guestFio${i}`].value.trim() ||
            !rsvpForm[`guestAlcohol${i}`].value
          ) {
            submitBtn.disabled = true;
            return;
          }
        }
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    }

    // Отправка формы
    rsvpForm.addEventListener('submit', e => {
      e.preventDefault();
      submitBtn.disabled = true;
      statusDiv.textContent = 'Отправка...';

      const attendance = rsvpForm.attendance.value;
      const data = { attendance, origin: rsvpForm.origin.value.trim() };

      if (attendance === 'no') {
        data.noFio = rsvpForm.noFio.value.trim();
        data.guests = [];
      } else {
        data.guests = [];
        const count = parseInt(guestCountSelect.value);
        for (let i = 1; i <= count; i++) {
          data.guests.push({
            fio: rsvpForm[`guestFio${i}`].value.trim(),
            alcohol: rsvpForm[`guestAlcohol${i}`].value,
            allergy: rsvpForm[`guestAllergy${i}`].value.trim(),
          });
        }
      }

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' },
      })
        .then(res => res.json())
        .then(response => {
          if (response.result === 'success') {
            statusDiv.textContent = 'Спасибо! Ваш ответ принят.';
            rsvpForm.reset();
            guestsContainer.innerHTML = '';
            noSection.classList.add('hidden');
            yesSection.classList.add('hidden');
            submitBtn.disabled = true;
          } else {
            statusDiv.textContent = 'Ошибка при отправке: ' + (response.message || 'неизвестная ошибка');
            submitBtn.disabled = false;
          }
        })
        .catch(err => {
          statusDiv.textContent = 'Ошибка соединения: ' + err.message;
          submitBtn.disabled = false;
        });
    });
  </script>
</body>
</html>