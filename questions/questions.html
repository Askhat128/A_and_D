<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>RSVP</title>
  <style>
    body { font-family: sans-serif; background: url('images/1.jpg') center/cover no-repeat; padding: 20px; }
    form { background: rgba(255,255,255,0.9); padding: 20px; max-width: 600px; margin: auto; border-radius: 10px; }
    .hidden { display:none; }
    .guest-block { margin-top:10px; border:1px solid #ccc; padding:10px; border-radius:8px; }
    label { display:block; margin-top:10px; }
    input, select { width:100%; padding:6px; box-sizing:border-box; margin-top:4px; }
    button{ margin-top:20px; padding:10px; font-size:16px; }
  </style>
</head>
<body>
  <form id="rsvpForm">
    <h2>1. Подтвердите участие:</h2>
    <label><input type="radio" name="attendance" value="yes" required> Придем</label>
    <label><input type="radio" name="attendance" value="no"> Не сможем</label>

    <div id="noSection" class="hidden">
      <label>ФИО: <input type="text" name="noFio" id="noFio"></label>
      <p>Нам очень жаль, но спасибо за поздравление!</p>
    </div>

    <div id="yesSection" class="hidden">
      <label>2. Количество гостей:
        <select id="guestCount">
          <option value="">Выберите</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </label>
      <div id="guestsContainer"></div>
    </div>

    <label>4. Откуда приедете?
      <input type="text" name="origin" id="origin" required>
    </label>

    <button type="submit" id="submitBtn" disabled>Отправить</button>
    <p id="status"></p>
  </form>

<script>
  const form = document.getElementById('rsvpForm');
  const noSection = document.getElementById('noSection');
  const yesSection = document.getElementById('yesSection');
  const guestCount = document.getElementById('guestCount');
  const guestsContainer = document.getElementById('guestsContainer');
  const submitBtn = document.getElementById('submitBtn');
  const status = document.getElementById('status');
  let attendance = '';

  const scriptURL = "https://script.google.com/macros/s/AKfycbzubPmFw_MwtfOByDKnlLX1ZVUgOIf9lI4-X4EqnOHV32Nnha3rPKyWfWaSTkGrVBea/exec"; // Вставь сюда свой URL

  form.querySelectorAll('input[name="attendance"]').forEach(inp => {
    inp.addEventListener('change', () => {
      attendance = inp.value;
      if (attendance === 'no') {
        noSection.classList.remove('hidden');
        yesSection.classList.add('hidden');
        submitBtn.disabled = false;
      } else {
        noSection.classList.add('hidden');
        yesSection.classList.remove('hidden');
        submitBtn.disabled = true;
      }
    });
  });

  guestCount.addEventListener('change', () => {
    guestsContainer.innerHTML = '';
    const count = parseInt(guestCount.value);
    if (count > 0) {
      for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.className = 'guest-block';
        div.innerHTML = `
          <label>ФИО гостя ${i}: <input type="text" name="guestFio${i}" required></label>
          <label>Алкоголь: 
            <select name="guestAlcohol${i}" required>
              <option value="">Выберите</option>
              <option>Красное вино</option>
              <option>Белое вино</option>
              <option>Самогон</option>
              <option>Не пью алкоголь</option>
            </select>
          </label>
          <label>Аллергия: <input type="text" name="guestAllergy${i}"></label>
        `;
        guestsContainer.appendChild(div);
      }
      submitBtn.disabled = false;
    } else {
      submitBtn.disabled = true;
    }
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();
    submitBtn.disabled = true;
    status.textContent = 'Отправка...';

    const origin = document.getElementById('origin').value.trim();
    if (!origin) { alert('Укажите, откуда вы приедете'); submitBtn.disabled=false; return; }

    const data = { attendance, origin };
    if (attendance === 'no') {
      const noFio = document.getElementById('noFio').value.trim();
      if (!noFio) { alert('Введите ФИО'); submitBtn.disabled=false; return; }
      data.noFio = noFio;
    } else {
      const guests = [];
      for (let i = 1; i <= parseInt(guestCount.value); i++) {
        const fio = form.querySelector(`[name="guestFio${i}"]`).value.trim();
        const alcohol = form.querySelector(`[name="guestAlcohol${i}"]`).value;
        const allergy = form.querySelector(`[name="guestAllergy${i}"]`).value.trim();
        if (!fio || !alcohol) { alert('Заполните ФИО и алкоголь'); submitBtn.disabled=false; return; }
        guests.push({ fio, alcohol, allergy });
      }
      data.guests = guests;
    }

    try {
      const resp = await fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const res = await resp.json();
      if (res.result === 'success') {
        status.textContent = 'Спасибо, данные отправлены!';
        form.reset();
        noSection.classList.add('hidden');
        yesSection.classList.add('hidden');
        guestsContainer.innerHTML = '';
      } else {
        status.textContent = 'Ошибка: ' + (res.message || 'неизвестная');
      }
    } catch (err) {
      status.textContent = 'Ошибка соединения';
      console.error(err);
    }
  });
</script>
</body>
</html>