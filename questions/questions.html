<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>RSVP Форма</title>
  <style>
    body {
      background-image: url('your-background.jpg'); /* замените на свой фон */
      background-size: cover;
      background-position: center;
      font-family: Arial, sans-serif;
      color: white;
      padding: 20px;
    }
    form {
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 12px;
      max-width: 800px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: none;
      margin-top: 5px;
    }
    .guest-block {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
    button:disabled {
      background-color: #aaa;
    }
  </style>
</head>
<body>

<form id="rsvpForm">
  <h2>RSVP</h2>

  <label>1. Подтвердите ваше участие:</label>
  <label><input type="radio" name="attendance" value="yes" required> Придем</label>
  <label><input type="radio" name="attendance" value="no"> Не сможем присутствовать</label>

  <div id="notComing" style="display:none;">
    <label>ФИО:</label>
    <input type="text" name="fio_no" id="fioNo">
    <p>Нам очень жаль, но спасибо за поздравление!</p>
  </div>

  <div id="coming" style="display:none;">
    <label>2. Укажите количество гостей от семьи:</label>
    <div id="guestCount"></div>
    <div id="guestBlocks"></div>

    <label>4. Откуда вы к нам приедете?</label>
    <input type="text" name="location" id="locationInput">
  </div>

  <br>
  <button type="submit" id="submitBtn" disabled>Отправить</button>
</form>

<script>
  const form = document.getElementById('rsvpForm');
  const notComingDiv = document.getElementById('notComing');
  const comingDiv = document.getElementById('coming');
  const guestCountDiv = document.getElementById('guestCount');
  const guestBlocksDiv = document.getElementById('guestBlocks');
  const submitBtn = document.getElementById('submitBtn');

  let selectedGuestCount = 0;

  form.attendance.forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.checked && radio.value === 'no') {
        notComingDiv.style.display = 'block';
        comingDiv.style.display = 'none';
        submitBtn.disabled = false;
      } else if (radio.checked && radio.value === 'yes') {
        notComingDiv.style.display = 'none';
        comingDiv.style.display = 'block';
        buildGuestCountOptions();
        submitBtn.disabled = true;
      }
    });
  });

  function buildGuestCountOptions() {
    guestCountDiv.innerHTML = '';
    for (let i = 1; i <= 6; i++) {
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = 'guest_count';
      radio.value = i;
      radio.id = 'guest_' + i;

      radio.addEventListener('change', () => {
        selectedGuestCount = parseInt(radio.value);
        buildGuestBlocks(selectedGuestCount);
      });

      const label = document.createElement('label');
      label.appendChild(radio);
      label.appendChild(document.createTextNode(` ${i} гость${i > 1 ? 'я' : ''}`));
      guestCountDiv.appendChild(label);
    }
  }

  function buildGuestBlocks(count) {
    guestBlocksDiv.innerHTML = '';
    for (let i = 1; i <= count; i++) {
      const block = document.createElement('div');
      block.className = 'guest-block';
      block.innerHTML = `
        <label>ФИО гостя ${i}:</label>
        <input type="text" name="guest_${i}_fio" required>

        <label>Какой алкоголь предпочитаете?</label>
        <select name="guest_${i}_alcohol" required>
          <option value="">Выберите</option>
          <option value="Красное вино">Красное вино</option>
          <option value="Белое вино">Белое вино</option>
          <option value="Самогон">Самогон</option>
          <option value="Не пью алкоголь">Не пью алкоголь</option>
        </select>

        <label>Есть ли аллергия на еду?</label>
        <input type="text" name="guest_${i}_allergy">
      `;
      guestBlocksDiv.appendChild(block);
    }
  }

  // Проверка на заполнение
  form.addEventListener('input', () => {
    const attending = form.attendance.value;
    if (attending === 'no') {
      submitBtn.disabled = document.getElementById('fioNo').value.trim() === '';
    } else if (attending === 'yes') {
      const locationFilled = document.getElementById('locationInput').value.trim() !== '';
      let guestsFilled = true;
      const inputs = guestBlocksDiv.querySelectorAll('input[required], select[required]');
      inputs.forEach(el => {
        if (!el.value.trim()) guestsFilled = false;
      });
      submitBtn.disabled = !(locationFilled && guestsFilled);
    } else {
      submitBtn.disabled = true;
    }
  });

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = {};
    new FormData(form).forEach((value, key) => {
      formData[key] = value;
    });

    fetch('https://script.google.com/macros/s/AKfycbyPpeoLWUwP8rElR-Cvxwr67xohzEnzlPAhpLD1_RuzraPUzsHK_Ndl9fP9NOIuXc8O8g/exec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
    .then(response => {
      if (!response.ok) throw new Error('Ошибка HTTP: ' + response.status);
      return response.text();
    })
    .then(data => {
      alert("✅ Форма успешно отправлена!\n" + data);
      form.reset();
      notComingDiv.style.display = 'none';
      comingDiv.style.display = 'none';
      guestCountDiv.innerHTML = '';
      guestBlocksDiv.innerHTML = '';
      submitBtn.disabled = true;
    })
    .catch(error => {
      alert("❌ Ошибка при отправке:\n" + error.message);
      console.error(error);
    });
  });
</script>

</body>
</html>